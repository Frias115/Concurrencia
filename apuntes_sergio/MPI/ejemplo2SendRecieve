

//Para compilar: mpicc ejemplo
//Para ejecutar: mpirun -np 4 (ruta del ejecutable)


#include "mpi.h"
#include <stdio.h>
#include <stdlib.h>

#define TAG 1

void maestro(int rank, int nproc){

	char *msg = (char  *)malloc(100);

	int source = rank;
	int dest = 1;
	sprintf(msg, "\n\n\t Esto es un mensaje del proceso %d al proceso %d", source, dest);

	for (int i = 1; i < nproc; i++){
		MPI_Send(msg, 100, MPI_CHAR, dest, TAG, MPI_COMM_WORLD);
		printf("\n Mensaje enviado a %d", i);
	}
}

void esclavo(int rank, int nproc){

	char *msg = (char  *)malloc(100);

	int dest = rank;
	MPI_Recv(msg, 100, MPI_CHAR, 0, TAG, MPI_COMM_WORLD, &status);
	printf("\n Mensaje recibido en %d", dest);
	printf("%s\n", msg);
}

int main(int arg, char **argv){
	int nproc, rank;
	MPI_Init(&argc, &argv);
	//MPI_COMM_WORLD: Comunicador
	MPI_Comm_size(MPI_COMM_WORLD, &nproc);
	MPI_Comm_rank(MPI_COMM_WORLD, &rank);

	MPI_Status status;

	if(rank == 0){
		maestro(rank, nproc);
	}
	else //if(rank == 1)
	{
		esclavo(rank, nproc);
	}
	MPI_Finalize();
	return 0;
}